<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Team Search</title>
    <style>
        .info-box {
            width: 300px;
            height: 300px;
            border: 1px solid #ccc;
            margin-bottom: 20px;
            position: relative;
            padding: 20px;
        }
        .join-button, .create-button, .cancel-button, .filter-button {
            padding: 10px 20px;
            color: white;
            border: none;
            cursor: pointer;
        }
        .join-button {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background-color: #4CAF50;
        }
        .cancel-button {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background-color: #f44336; /* Red for cancel */
        }
        .create-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #008CBA;
        }
        .filter-button {
            background-color: #4CAF50;
        }
        #filter-container {
            margin-bottom: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="filter-container">
        <input type="text" id="filter-input" placeholder="Search by Team Name or Game">
        <button class="filter-button" onclick="filterTeams()">Filter</button>
    </div>
    <div id="info-container"></div> <!-- Container for displaying team boxes -->
    <button class="create-button" onclick="createTeam()">Create Team</button>

    <script>
        const container = document.getElementById('info-container');
        let teams = []; // This will store the teams data received from server
        let websocket = new WebSocket('ws://localhost:8000/ws/team_search/'); // Adjust the URL to your WebSocket connection

        websocket.onmessage = function(event) {
            const data = JSON.parse(event.data);
            if (data.type === 'all_teams') {
                teams = data.teams;
                displayTeams(teams);
            } else if (data.type === 'update_team') {
                teams.push(data.team);
                displayTeams(teams);
            }
        };

        function displayTeams(filteredTeams) {
            container.innerHTML = '';
            filteredTeams.forEach((team, index) => {
                const infoBox = document.createElement('div');
                infoBox.className = 'info-box';
                infoBox.innerHTML = `
                    <h3>Team Name: ${team.name}</h3>
                    <p>Description: ${team.description}</p>
                    <p>Game: ${team.game}</p>
                    <p>Members Needed: ${team.membersNeeded}</p>
                    <button class="join-button" onclick="alert('Contact: ${team.contact}')">Join Request</button>
                    ${team.creator === currentUserEmail ? '<button class="cancel-button" onclick="cancelTeam('+index+')">Cancel</button>' : ''}
                `;
                container.appendChild(infoBox);
            });
        }

        function filterTeams() {
            const filterValue = document.getElementById('filter-input').value.toLowerCase();
            const filteredTeams = teams.filter(team => 
                team.name.toLowerCase().includes(filterValue) || 
                team.game.toLowerCase().includes(filterValue));
            displayTeams(filteredTeams);
        }

        function createTeam() {
            const teamName = prompt("Enter team name:");
            const description = prompt("Enter team description:");
            const game = prompt("Enter game:");
            const membersNeeded = prompt("Enter number of members needed:");
            const contact = prompt("Enter contact information:");
            if (teamName && description && game && membersNeeded && contact) {
                const teamData = { name: teamName, description: description, game: game, membersNeeded: parseInt(membersNeeded), contact: contact };
                websocket.send(JSON.stringify(teamData)); // Send new team data to the server
            }
        }

        function cancelTeam(index) {
            teams.splice(index, 1); // Remove team locally
            displayTeams(teams); // Re-display teams
            // Optionally, send a delete command to the server
            websocket.send(JSON.stringify({ action: 'delete', index: index }));
        }
    </script>
</body>
</html>
